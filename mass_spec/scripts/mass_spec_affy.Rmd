---
title: "Pachytene TUTs Affy - Mass spec"
output: html_document
params:
  experiment:
    value: 2018-09_pachytene_tuts
  affy:
    value: ../../../arrays/results/pachytene_tuts_single/ctrl_p-dcko_p/sic.Rda
  change_a:
    value: 25
  significance_a:
    value: 0.05
  change_b:
    value: 1
  significance_b:
    value: 0.01
---

<!-- Load libraries -->
```{r include=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
```

<!-- Clean --> 
```{r include=FALSE}
rm(list= ls()[!ls() %in% c("params")])
source("helper_functions.R")
```

```{r include=FALSE}
mass_spec <- readRDS(file=paste("../projects/", params$experiment,
                                "/views/mass_spec.Rda", sep="")) %>%
                  rename(change_a       = change,
                         significance_a = q_value,
                         label = Protein.IDs)

sic      <- readRDS(file = params$affy) %>%
                   mutate(change_b = -1 * as.numeric(change),
                          significance_b = as.numeric(sig),
                          label = ids) %>%
                   select(label, change_b, significance_b)
```

```{r include=FALSE}
merge <- left_join(mass_spec, sic, by = "label") %>% 
         rowwise() %>% filter(!is.na(change_b)) %>%
         mutate(change_a_ = if_else(abs(change_a) > params$change_a, 1, 0),
                significance_a_ = if_else(significance_a < 
                                            params$significance_a, 1, 0),
                change_b_ = if_else(abs(change_b) > params$change_b, 1, 0),
                significance_b_ = if_else(significance_b < 
                                            params$significance_b, 1, 0)
                ) %>% 
         mutate(group_a = change_a_ * significance_a_,
                group_b = change_b_ * significance_b_) %>%
         mutate(group_a_b = group_a * group_b) %>%
         select(-change_a_, -significance_a_, -change_b_, -significance_b_)

```

```{r include=FALSE}
# saveRDS(merge, file=paste("../views/", params$experiment, 
#                           "/", params$sample, "/scatter_plot.Rda", sep=""))

write.csv2(merge, "../merge.csv")
```

####Significant Affy and Mass spec
```{r echo=FALSE}
merge <- merge %>% filter(change_a > -200)

plot <- ggplot(merge, aes(x=change_a, y=change_b, color=group_a_b)) + geom_point() +
     ylab("Affy fold change") + xlab("Mass spec fold change")

plot
```

####Significant Affy 
```{r echo=FALSE}
merge <- merge %>% filter(change_a > -200)

plot <- ggplot(merge, aes(x=change_a, y=change_b, color=group_b)) + geom_point() +
     ylab("Affy fold change") + xlab("Mass spec fold change")

plot
```

####Significant Mass Spec 
```{r echo=FALSE}
merge <- merge %>% filter(change_a > -200)

plot <- ggplot(merge, aes(x=change_a, y=change_b, color=group_a)) + geom_point() +
     ylab("Affy fold change") + xlab("Mass spec fold change")

plot
```

```{r}

```

